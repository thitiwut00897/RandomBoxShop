{"ast":null,"code":"var _jsxFileName = \"/Users/thitiwutphophan/shop/src/contexts/BagContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { petService } from '../services/petService';\nimport { useAuth } from './AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BagContext = /*#__PURE__*/createContext(undefined);\nexport const useBag = () => {\n  _s();\n  const context = useContext(BagContext);\n  if (context === undefined) {\n    throw new Error('useBag must be used within a BagProvider');\n  }\n  return context;\n};\n_s(useBag, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const BagProvider = ({\n  children\n}) => {\n  _s2();\n  const {\n    user\n  } = useAuth();\n  const [userBag, setUserBag] = useState(null);\n\n  // Initialize pets from API when the provider mounts\n  useEffect(() => {\n    petService.initialize().catch(error => {\n      console.error('Failed to initialize pets:', error);\n    });\n  }, []);\n\n  // Load bag from localStorage when user changes\n  useEffect(() => {\n    if (user) {\n      const savedBag = localStorage.getItem(`userBag_${user.id}`);\n      if (savedBag) {\n        const parsedBag = JSON.parse(savedBag);\n        // Convert date strings back to Date objects\n        parsedBag.petBoxes = parsedBag.petBoxes.map(box => ({\n          ...box,\n          purchaseDate: new Date(box.purchaseDate)\n        }));\n        setUserBag(parsedBag);\n      } else {\n        // Create new bag for user\n        setUserBag({\n          userId: user.id,\n          petBoxes: [],\n          pets: []\n        });\n      }\n    } else {\n      setUserBag(null);\n    }\n  }, [user]);\n\n  // Save bag to localStorage whenever it changes\n  useEffect(() => {\n    if (userBag && user) {\n      localStorage.setItem(`userBag_${user.id}`, JSON.stringify(userBag));\n    }\n  }, [userBag, user]);\n  const addPetBoxes = (productId, productName, quantity) => {\n    if (!userBag) return;\n    const newBoxes = [];\n    for (let i = 0; i < quantity; i++) {\n      newBoxes.push({\n        id: `${productId}_${Date.now()}_${i}`,\n        productId,\n        productName,\n        purchaseDate: new Date(),\n        isOpened: false\n      });\n    }\n    setUserBag(prev => prev ? {\n      ...prev,\n      petBoxes: [...prev.petBoxes, ...newBoxes]\n    } : null);\n  };\n  const openPetBox = async boxId => {\n    if (!userBag) {\n      throw new Error('No bag found');\n    }\n    const box = userBag.petBoxes.find(b => b.id === boxId);\n    if (!box) {\n      throw new Error('Box not found');\n    }\n    if (box.isOpened) {\n      throw new Error('Box already opened');\n    }\n\n    // Get a random pet\n    const randomPets = petService.getRandomPets(1);\n    const pet = randomPets[0];\n\n    // Update the bag\n    const updatedBag = {\n      ...userBag,\n      petBoxes: userBag.petBoxes.map(b => b.id === boxId ? {\n        ...b,\n        isOpened: true,\n        openedAt: new Date()\n      } : b),\n      pets: [...userBag.pets, pet]\n    };\n    setUserBag(updatedBag);\n    localStorage.setItem(`userBag_${user === null || user === void 0 ? void 0 : user.id}`, JSON.stringify(updatedBag));\n    return pet;\n  };\n  const getUnopenedBoxes = () => {\n    return (userBag === null || userBag === void 0 ? void 0 : userBag.petBoxes.filter(box => !box.isOpened)) || [];\n  };\n  const getOpenedBoxes = () => {\n    return (userBag === null || userBag === void 0 ? void 0 : userBag.petBoxes.filter(box => box.isOpened)) || [];\n  };\n  const getAllPets = () => {\n    return (userBag === null || userBag === void 0 ? void 0 : userBag.pets) || [];\n  };\n  const clearBag = () => {\n    setUserBag(null);\n    if (user) {\n      localStorage.removeItem(`userBag_${user.id}`);\n    }\n  };\n  const value = {\n    userBag,\n    addPetBoxes,\n    openPetBox,\n    getUnopenedBoxes,\n    getOpenedBoxes,\n    getAllPets,\n    clearBag\n  };\n  return /*#__PURE__*/_jsxDEV(BagContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this);\n};\n_s2(BagProvider, \"NlsI22Bw7VandZczm0clggX+u44=\", false, function () {\n  return [useAuth];\n});\n_c = BagProvider;\nvar _c;\n$RefreshReg$(_c, \"BagProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","petService","useAuth","jsxDEV","_jsxDEV","BagContext","undefined","useBag","_s","context","Error","BagProvider","children","_s2","user","userBag","setUserBag","initialize","catch","error","console","savedBag","localStorage","getItem","id","parsedBag","JSON","parse","petBoxes","map","box","purchaseDate","Date","userId","pets","setItem","stringify","addPetBoxes","productId","productName","quantity","newBoxes","i","push","now","isOpened","prev","openPetBox","boxId","find","b","randomPets","getRandomPets","pet","updatedBag","openedAt","getUnopenedBoxes","filter","getOpenedBoxes","getAllPets","clearBag","removeItem","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/thitiwutphophan/shop/src/contexts/BagContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { UserBag, PetBox, Pet } from '../types';\nimport { petService } from '../services/petService';\nimport { useAuth } from './AuthContext';\n\ninterface BagContextType {\n  userBag: UserBag | null;\n  addPetBoxes: (productId: string, productName: string, quantity: number) => void;\n  openPetBox: (boxId: string) => Promise<Pet>;\n  getUnopenedBoxes: () => PetBox[];\n  getOpenedBoxes: () => PetBox[];\n  getAllPets: () => Pet[];\n  clearBag: () => void;\n}\n\nconst BagContext = createContext<BagContextType | undefined>(undefined);\n\nexport const useBag = () => {\n  const context = useContext(BagContext);\n  if (context === undefined) {\n    throw new Error('useBag must be used within a BagProvider');\n  }\n  return context;\n};\n\ninterface BagProviderProps {\n  children: ReactNode;\n}\n\nexport const BagProvider: React.FC<BagProviderProps> = ({ children }) => {\n  const { user } = useAuth();\n  const [userBag, setUserBag] = useState<UserBag | null>(null);\n\n  // Initialize pets from API when the provider mounts\n  useEffect(() => {\n    petService.initialize().catch((error: Error) => {\n      console.error('Failed to initialize pets:', error);\n    });\n  }, []);\n\n  // Load bag from localStorage when user changes\n  useEffect(() => {\n    if (user) {\n      const savedBag = localStorage.getItem(`userBag_${user.id}`);\n      if (savedBag) {\n        const parsedBag = JSON.parse(savedBag);\n        // Convert date strings back to Date objects\n        parsedBag.petBoxes = parsedBag.petBoxes.map((box: any) => ({\n          ...box,\n          purchaseDate: new Date(box.purchaseDate)\n        }));\n        setUserBag(parsedBag);\n      } else {\n        // Create new bag for user\n        setUserBag({\n          userId: user.id,\n          petBoxes: [],\n          pets: []\n        });\n      }\n    } else {\n      setUserBag(null);\n    }\n  }, [user]);\n\n  // Save bag to localStorage whenever it changes\n  useEffect(() => {\n    if (userBag && user) {\n      localStorage.setItem(`userBag_${user.id}`, JSON.stringify(userBag));\n    }\n  }, [userBag, user]);\n\n  const addPetBoxes = (productId: string, productName: string, quantity: number) => {\n    if (!userBag) return;\n\n    const newBoxes: PetBox[] = [];\n    for (let i = 0; i < quantity; i++) {\n      newBoxes.push({\n        id: `${productId}_${Date.now()}_${i}`,\n        productId,\n        productName,\n        purchaseDate: new Date(),\n        isOpened: false\n      });\n    }\n\n    setUserBag(prev => prev ? {\n      ...prev,\n      petBoxes: [...prev.petBoxes, ...newBoxes]\n    } : null);\n  };\n\n  const openPetBox = async (boxId: string): Promise<Pet> => {\n    if (!userBag) {\n      throw new Error('No bag found');\n    }\n\n    const box = userBag.petBoxes.find(b => b.id === boxId);\n    if (!box) {\n      throw new Error('Box not found');\n    }\n\n    if (box.isOpened) {\n      throw new Error('Box already opened');\n    }\n\n    // Get a random pet\n    const randomPets = petService.getRandomPets(1);\n    const pet = randomPets[0];\n\n    // Update the bag\n    const updatedBag: UserBag = {\n      ...userBag,\n      petBoxes: userBag.petBoxes.map(b => \n        b.id === boxId \n          ? { ...b, isOpened: true, openedAt: new Date() }\n          : b\n      ),\n      pets: [...userBag.pets, pet]\n    };\n\n    setUserBag(updatedBag);\n    localStorage.setItem(`userBag_${user?.id}`, JSON.stringify(updatedBag));\n\n    return pet;\n  };\n\n  const getUnopenedBoxes = (): PetBox[] => {\n    return userBag?.petBoxes.filter(box => !box.isOpened) || [];\n  };\n\n  const getOpenedBoxes = (): PetBox[] => {\n    return userBag?.petBoxes.filter(box => box.isOpened) || [];\n  };\n\n  const getAllPets = (): Pet[] => {\n    return userBag?.pets || [];\n  };\n\n  const clearBag = () => {\n    setUserBag(null);\n    if (user) {\n      localStorage.removeItem(`userBag_${user.id}`);\n    }\n  };\n\n  const value = {\n    userBag,\n    addPetBoxes,\n    openPetBox,\n    getUnopenedBoxes,\n    getOpenedBoxes,\n    getAllPets,\n    clearBag\n  };\n\n  return (\n    <BagContext.Provider value={value}>\n      {children}\n    </BagContext.Provider>\n  );\n}; "],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,SAAS,QAAmB,OAAO;AAExF,SAASC,UAAU,QAAQ,wBAAwB;AACnD,SAASC,OAAO,QAAQ,eAAe;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAYxC,MAAMC,UAAU,gBAAGR,aAAa,CAA6BS,SAAS,CAAC;AAEvE,OAAO,MAAMC,MAAM,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC1B,MAAMC,OAAO,GAAGX,UAAU,CAACO,UAAU,CAAC;EACtC,IAAII,OAAO,KAAKH,SAAS,EAAE;IACzB,MAAM,IAAII,KAAK,CAAC,0CAA0C,CAAC;EAC7D;EACA,OAAOD,OAAO;AAChB,CAAC;AAACD,EAAA,CANWD,MAAM;AAYnB,OAAO,MAAMI,WAAuC,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,GAAA;EACvE,MAAM;IAAEC;EAAK,CAAC,GAAGZ,OAAO,CAAC,CAAC;EAC1B,MAAM,CAACa,OAAO,EAAEC,UAAU,CAAC,GAAGjB,QAAQ,CAAiB,IAAI,CAAC;;EAE5D;EACAC,SAAS,CAAC,MAAM;IACdC,UAAU,CAACgB,UAAU,CAAC,CAAC,CAACC,KAAK,CAAEC,KAAY,IAAK;MAC9CC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IACpD,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;;EAEN;EACAnB,SAAS,CAAC,MAAM;IACd,IAAIc,IAAI,EAAE;MACR,MAAMO,QAAQ,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAWT,IAAI,CAACU,EAAE,EAAE,CAAC;MAC3D,IAAIH,QAAQ,EAAE;QACZ,MAAMI,SAAS,GAAGC,IAAI,CAACC,KAAK,CAACN,QAAQ,CAAC;QACtC;QACAI,SAAS,CAACG,QAAQ,GAAGH,SAAS,CAACG,QAAQ,CAACC,GAAG,CAAEC,GAAQ,KAAM;UACzD,GAAGA,GAAG;UACNC,YAAY,EAAE,IAAIC,IAAI,CAACF,GAAG,CAACC,YAAY;QACzC,CAAC,CAAC,CAAC;QACHf,UAAU,CAACS,SAAS,CAAC;MACvB,CAAC,MAAM;QACL;QACAT,UAAU,CAAC;UACTiB,MAAM,EAAEnB,IAAI,CAACU,EAAE;UACfI,QAAQ,EAAE,EAAE;UACZM,IAAI,EAAE;QACR,CAAC,CAAC;MACJ;IACF,CAAC,MAAM;MACLlB,UAAU,CAAC,IAAI,CAAC;IAClB;EACF,CAAC,EAAE,CAACF,IAAI,CAAC,CAAC;;EAEV;EACAd,SAAS,CAAC,MAAM;IACd,IAAIe,OAAO,IAAID,IAAI,EAAE;MACnBQ,YAAY,CAACa,OAAO,CAAC,WAAWrB,IAAI,CAACU,EAAE,EAAE,EAAEE,IAAI,CAACU,SAAS,CAACrB,OAAO,CAAC,CAAC;IACrE;EACF,CAAC,EAAE,CAACA,OAAO,EAAED,IAAI,CAAC,CAAC;EAEnB,MAAMuB,WAAW,GAAGA,CAACC,SAAiB,EAAEC,WAAmB,EAAEC,QAAgB,KAAK;IAChF,IAAI,CAACzB,OAAO,EAAE;IAEd,MAAM0B,QAAkB,GAAG,EAAE;IAC7B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,EAAEE,CAAC,EAAE,EAAE;MACjCD,QAAQ,CAACE,IAAI,CAAC;QACZnB,EAAE,EAAE,GAAGc,SAAS,IAAIN,IAAI,CAACY,GAAG,CAAC,CAAC,IAAIF,CAAC,EAAE;QACrCJ,SAAS;QACTC,WAAW;QACXR,YAAY,EAAE,IAAIC,IAAI,CAAC,CAAC;QACxBa,QAAQ,EAAE;MACZ,CAAC,CAAC;IACJ;IAEA7B,UAAU,CAAC8B,IAAI,IAAIA,IAAI,GAAG;MACxB,GAAGA,IAAI;MACPlB,QAAQ,EAAE,CAAC,GAAGkB,IAAI,CAAClB,QAAQ,EAAE,GAAGa,QAAQ;IAC1C,CAAC,GAAG,IAAI,CAAC;EACX,CAAC;EAED,MAAMM,UAAU,GAAG,MAAOC,KAAa,IAAmB;IACxD,IAAI,CAACjC,OAAO,EAAE;MACZ,MAAM,IAAIL,KAAK,CAAC,cAAc,CAAC;IACjC;IAEA,MAAMoB,GAAG,GAAGf,OAAO,CAACa,QAAQ,CAACqB,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC1B,EAAE,KAAKwB,KAAK,CAAC;IACtD,IAAI,CAAClB,GAAG,EAAE;MACR,MAAM,IAAIpB,KAAK,CAAC,eAAe,CAAC;IAClC;IAEA,IAAIoB,GAAG,CAACe,QAAQ,EAAE;MAChB,MAAM,IAAInC,KAAK,CAAC,oBAAoB,CAAC;IACvC;;IAEA;IACA,MAAMyC,UAAU,GAAGlD,UAAU,CAACmD,aAAa,CAAC,CAAC,CAAC;IAC9C,MAAMC,GAAG,GAAGF,UAAU,CAAC,CAAC,CAAC;;IAEzB;IACA,MAAMG,UAAmB,GAAG;MAC1B,GAAGvC,OAAO;MACVa,QAAQ,EAAEb,OAAO,CAACa,QAAQ,CAACC,GAAG,CAACqB,CAAC,IAC9BA,CAAC,CAAC1B,EAAE,KAAKwB,KAAK,GACV;QAAE,GAAGE,CAAC;QAAEL,QAAQ,EAAE,IAAI;QAAEU,QAAQ,EAAE,IAAIvB,IAAI,CAAC;MAAE,CAAC,GAC9CkB,CACN,CAAC;MACDhB,IAAI,EAAE,CAAC,GAAGnB,OAAO,CAACmB,IAAI,EAAEmB,GAAG;IAC7B,CAAC;IAEDrC,UAAU,CAACsC,UAAU,CAAC;IACtBhC,YAAY,CAACa,OAAO,CAAC,WAAWrB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEU,EAAE,EAAE,EAAEE,IAAI,CAACU,SAAS,CAACkB,UAAU,CAAC,CAAC;IAEvE,OAAOD,GAAG;EACZ,CAAC;EAED,MAAMG,gBAAgB,GAAGA,CAAA,KAAgB;IACvC,OAAO,CAAAzC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEa,QAAQ,CAAC6B,MAAM,CAAC3B,GAAG,IAAI,CAACA,GAAG,CAACe,QAAQ,CAAC,KAAI,EAAE;EAC7D,CAAC;EAED,MAAMa,cAAc,GAAGA,CAAA,KAAgB;IACrC,OAAO,CAAA3C,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEa,QAAQ,CAAC6B,MAAM,CAAC3B,GAAG,IAAIA,GAAG,CAACe,QAAQ,CAAC,KAAI,EAAE;EAC5D,CAAC;EAED,MAAMc,UAAU,GAAGA,CAAA,KAAa;IAC9B,OAAO,CAAA5C,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEmB,IAAI,KAAI,EAAE;EAC5B,CAAC;EAED,MAAM0B,QAAQ,GAAGA,CAAA,KAAM;IACrB5C,UAAU,CAAC,IAAI,CAAC;IAChB,IAAIF,IAAI,EAAE;MACRQ,YAAY,CAACuC,UAAU,CAAC,WAAW/C,IAAI,CAACU,EAAE,EAAE,CAAC;IAC/C;EACF,CAAC;EAED,MAAMsC,KAAK,GAAG;IACZ/C,OAAO;IACPsB,WAAW;IACXU,UAAU;IACVS,gBAAgB;IAChBE,cAAc;IACdC,UAAU;IACVC;EACF,CAAC;EAED,oBACExD,OAAA,CAACC,UAAU,CAAC0D,QAAQ;IAACD,KAAK,EAAEA,KAAM;IAAAlD,QAAA,EAC/BA;EAAQ;IAAAoD,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACU,CAAC;AAE1B,CAAC;AAACtD,GAAA,CApIWF,WAAuC;EAAA,QACjCT,OAAO;AAAA;AAAAkE,EAAA,GADbzD,WAAuC;AAAA,IAAAyD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}